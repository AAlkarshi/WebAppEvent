{%  extends "base.html.twig" %}

{%  block title %}
Accueil
{%  endblock %}

{%  block body %}
<div style="width: 100%; text-align: center; margin-bottom: 30px;">
    <h1>Nous retrouver autour d'un √©v√©nement</h1>
    <h3>Vous pr√©parez un √©v√©nement ? Ne restez plus seul ! Retrouvez-vous autour d‚Äôune activit√© tous ensemble.</h3>
</div>

<section class="event-container">

    <!-- üß≠ COLONNE GAUCHE - FILTRES -->
    <div class="filters">

    {% if selectedCategory %}
            <p style="text-align:center; font-style:italic;">
                √âv√©nements pour la cat√©gorie :
                <strong>
                    {{ categories|filter(cat => cat.id == selectedCategory)|first.nameCategory }}
                </strong>
        </p>
    {% endif %}

    <!-- MSG D'AFFICHAGE POUR BARRE DE RECHERCHE FILTREE RESULTAT-->
    {% if searchCity %}
        <p style="text-align:center; font-style:italic;">
            R√©sultats pour la ville : <strong>{{ searchCity }}</strong>
        </p>
    {% endif %}





        <!-- BARRE DE RECHERCHE PAR VILLE -->
        <form action="{{ path('app_events') }}" method="get" class="search-bar">
            <input type="search" name="terme" placeholder="Saisir le nom d'une ville" value="{{ searchCity ?? '' }}">
            <button type="submit"><i class="fa-solid fa-magnifying-glass"></i></button>
        </form>


        

        <!-- Filtres Date et Dur√©e -->
        <div class="date-duration">
            <button style="margin-bottom: 10px;"><i class="fa-solid fa-calendar-days"></i> Dates</button>
            
        </div>
                
                <!--  HORLOGE DUREE FILTRE
                    <div>
                        <button><i class="fa-solid fa-clock"></i> Dur√©e</button>
                    </div>
                -->

       <!-- Liste d√©roulante Cat√©gories -->
        <div class="filter-row">
            <form action="{{ path('app_events') }}" method="get">
                <select name="id_category" onchange="this.form.submit()">
                    <option value="">Toutes les cat√©gories</option>
                    {% for cat in categories %}
                        <option value="{{ cat.id }}" {% if selectedCategory == cat.id %}selected{% endif %}>
                            {{ cat.nameCategory }}
                        </option>
                    {% endfor %}
                </select>
            </form>
        </div>



        <!-- Filtres √Çge -->
        <div class="filter">
            <label>√Çge minimum : <span id="minAge">18</span></label>
            <input type="range" id="minRange" min="18" max="99" value="18">

            <label>√Çge maximum : <span id="maxAge">99</span></label>
            <input type="range" id="maxRange" min="18" max="99" value="99">
        </div>

        <!-- Filtre Date -->
        <form method="GET" action="" class="date-filter">
            <label for="start_date">üìÖ √Ä partir du :</label>
            <input type="date" id="start_date" name="start_date" max="<?= date('Y-m-d') ?>" />
            <button type="submit">Filtrer</button>
        </form>
    </div>

    <!-- üß± COLONNE DROITE - GRILLE DES √âV√âNEMENTS -->
    
<div class="event-container">
      {% if events is not empty %}
        <div class="events-grid">
            {% for event in events %}
                <div class="event-card">
                    {# Image - utilise le fichier si pr√©sent sinon image par d√©faut #}
                    {% if event.imageEvent %}
                        <img src="{{ asset('uploads/avatars/' ~ event.imageEvent) }}" alt="{{ event.titleEvent }}" class="event-image">
                    {% else %}
                        <img src="{{ asset('uploads/avatars/default.png') }}" alt="Image par d√©faut" class="event-image">
                    {% endif %}

                    {# Contenu overlay (titre centr√©) #}
                    <div class="event-overlay">
                        <h2 class="event-title">{{ event.titleEvent }}</h2>

                        <div class="event-meta">
                            {# cat√©gorie (prot√©g√© si null) #}
                            {% if event.category %}
                                <span class="event-category">{{ event.category.nameCategory }}</span>
                            {% endif %}

                            <div class="event-date">üìÖ {{ event.dateTimeEvent ? (event.dateTimeEvent|date('d/m/Y H:i')) : 'Date non d√©finie' }}</div>

                            {% if event.address %}
                                <div class="event-address">üìç {{ event.address.address }}, {{ event.address.city }}</div>
                            {% endif %}
                            
                        </div>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p>Aucun √©v√©nement trouv√©.</p>
    {% endif %}
</div>

</section>

<!-- üß† SCRIPT JS -->
<script>
    const minRange = document.getElementById('minRange');
    const maxRange = document.getElementById('maxRange');
    const minAge = document.getElementById('minAge');
    const maxAge = document.getElementById('maxAge');

    minRange.addEventListener('input', () => {
        if (parseInt(minRange.value) > parseInt(maxRange.value)) {
            minRange.value = maxRange.value;
        }
        minAge.textContent = minRange.value;
    });

    maxRange.addEventListener('input', () => {
        if (parseInt(maxRange.value) < parseInt(minRange.value)) {
            maxRange.value = minRange.value;
        }
        maxAge.textContent = maxRange.value;
    });
</script>

<!-- üé® STYLE CSS -->
<style>
    /* --- Structure g√©n√©rale --- */
    .event-container {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 30px;
        width: 100%;
        padding: 20px;
        box-sizing: border-box;
    }

    /* --- Colonne gauche (Filtres) --- */
    .filters {
        width: 30%;
        background-color: #f5f5f5;
        padding: 20px;
        border-radius: 10px;
    }

    .filters form,
    .filters div {
        margin-bottom: 20px;
    }

    .search-bar {
        display: flex;
        gap: 10px;
    }

    .search-bar input {
        flex: 1;
        padding: 10px;
        border-radius: 5px;
        border: 1px solid #ccc;
    }

    .search-bar button {
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 5px;
        padding: 10px 15px;
    }

    /* --- Colonne droite (Grille des √©v√©nements) --- */
    .event-grid {
        width: 70%;
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
        gap: 25px;
    }

    .event-card {
        background: white;
        border-radius: 10px;
        box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        text-align: center;
        padding-bottom: 20px;
        transition: transform 0.2s ease;
    }

    .event-card:hover {
        transform: scale(1.03);
    }

    .event-card img {
        width: 100%;
        border-radius: 10px 10px 0 0;
    }

    /* --- Responsive --- */
    @media screen and (max-width: 900px) {
        .event-container {
            flex-direction: column;
        }
        .filters, .event-grid {
            width: 100%;
        }
    }
</style>

{%  endblock %}


