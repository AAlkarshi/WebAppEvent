{%  extends "base.html.twig" %}

{%  block title %}
Accueil
{%  endblock %}

{%  block body %}
<div style="width: 100%; text-align: center; margin-bottom: 30px;">
    <h1>Nous retrouver autour d'un √©v√©nement</h1>
    <h3>Vous pr√©parez un √©v√©nement ? Ne restez plus seul ! Retrouvez-vous autour d‚Äôune activit√© tous ensemble.</h3>
</div>

<section class="event-container">

    <!-- üß≠ COLONNE GAUCHE - FILTRES -->
    <div class="filters">

   

    




<form action="{{ path('app_events') }}" method="get" class="filter-form">

    <!-- Barre de recherche par ville -->
    <div class="search-bar">
        <input type="search" name="terme" placeholder="Saisir le nom d'une ville" value="{{ searchCity ?? '' }}">
        <button type="submit"><i class="fa-solid fa-magnifying-glass"></i></button>
    </div>

    <!-- Liste d√©roulante des cat√©gories -->
    <div class="filter-row">
        <select name="id_category">
            <option value="">Toutes les cat√©gories</option>
            {% for cat in categories %}
                <option value="{{ cat.id }}" {% if selectedCategory == cat.id %}selected{% endif %}>
                    {{ cat.nameCategory }}
                </option>
            {% endfor %}
        </select>
    </div>

    <!-- Filtres de date -->
    <div class="date-filter">
        <label for="start_date">üìÖ √Ä partir du :</label>
        <input type="date" id="start_date" name="start_date" value="{{ startDate ?? '' }}">

        <label for="end_date">üìÖ Jusqu'au :</label>
        <input type="date" id="end_date" name="end_date" value="{{ endDate ?? '' }}">
    </div>

    <!-- Boutons -->
    <div class="filter-buttons">
        <button type="submit" class="btn-filter">Filtrer</button>
        <a href="{{ path('app_events') }}" class="btn-reset">R√©initialiser</a>
    </div>
</form>

{% if searchCity or selectedCategory or startDate or endDate %}
    <div class="active-filters">
        <h4>Filtres actifs :</h4>
        <ul>
            {% if searchCity %}
                <li>üèôÔ∏è Ville : <strong>{{ searchCity }}</strong></li>
            {% endif %}
            {% if selectedCategory %}
                {% set catName = categories|filter(c => c.id == selectedCategory)|first %}
                {% if catName %}
                    <li>üìÇ Cat√©gorie : <strong>{{ catName.nameCategory }}</strong></li>
                {% endif %}
            {% endif %}
            {% if startDate %}
                <li>üìÖ √Ä partir du : <strong>{{ startDate|date('d/m/Y') }}</strong></li>
            {% endif %}
            {% if endDate %}
                <li>üìÖ Jusqu‚Äôau : <strong>{{ endDate|date('d/m/Y') }}</strong></li>
            {% endif %}
        </ul>
    </div>
{% endif %}

       


        {% if events is empty %}
    <p>Vous n‚Äôavez cr√©√© aucun √©v√©nement pour le moment.</p>
{% else %}
    {# Affiche le nombre total d'√©v√©nements une seule fois #}
  <p>
    {{ events.getTotalItemCount }} √©v√©nement{{ events.getTotalItemCount > 1 ? 's' : '' }} trouv√©{{ events.getTotalItemCount > 1 ? 's' : '' }}.
</p>
   
{% endif %}


{% for label, messages in app.flashes %}
    {% for message in messages %}
        <div class="alert alert-{{ label }}">
            {{ message }}
        </div>
    {% endfor %}
{% endfor %}


    </div>

    <!-- üß± COLONNE DROITE - GRILLE DES √âV√âNEMENTS -->
    
<div class="event-container">
    
      {% if events is not empty %}
    <div class="events-grid">
        {% for event in events %}
            <div class="event-card">
                    {% if event.imageEvent %}
                        <img src="{{ asset('uploads/events/' ~ event.imageEvent) }}" 
                            alt="{{ event.titleEvent }}" class="event-image">
                    {% else %}
                        <img src="{{ asset('uploads/events/autre√©v√®nement.jpg') }}" 
                            alt="Image par d√©faut"  class="event-image">
                    {% endif %}


                <div class="event-overlay">

                   


                        <!-- Btn supp visible uniquement pour l'ADMIN -->
                        {% if is_granted('ROLE_ADMIN') %}
                            <form action="{{ path('app_event_delete', {id: event.id}) }}" method="post" onsubmit="return confirm('‚ö†Ô∏è √ätes-vous s√ªr de vouloir supprimer cet √©v√©nement ?');">
                                <input type="hidden" name="_token" value="{{ csrf_token('delete_event_' ~ event.id) }}">
                                <button type="submit" class="btn-delete">üóëÔ∏è Supprimer</button>
                            </form>
                        {% endif %}

                    <h2 class="event-title">{{ event.titleEvent }}</h2>

                    <div class="event-meta">
                        {% if event.category %}
                            <span class="event-category">{{ event.category.nameCategory }}</span>
                        {% endif %}

                        <div class="event-date">üìÖ {{ event.dateTimeEvent ? (event.dateTimeEvent|date('d/m/Y H:i')) : 'Date non d√©finie' }}</div>

                        {% if event.address %}
                            <div class="event-address">üìç {{ event.address.address }}, {{ event.address.city }}</div>
                        {% endif %}


                        
                       


                {# Bouton ‚ÄúS‚Äôinscrire‚Äù seulement si l‚Äôutilisateur est connect√© #}
                    {% if app.user %}
                    <button>    
                        <a href="{{ path('viewthisevent', {id: event.id}) }}" class="btn btn-primary">
                            Voir +
                        </a>
                    </button>
                        <br>
                        
                     {% if event.nbxParticipantMax is not null and event.nbxParticipant >= event.nbxParticipantMax %}
                            <span style="color:green; font-weight:bold;">COMPLET</span>
                        {% else %}
                       <button>
                             <a href="{{ path('event_register', {id: event.id}) }}" class="btn btn-primary">S'inscrire</a>
                       </button>
                             {% endif %}
                        {% else %}
                            <p><em>Connectez-vous pour vous inscrire</em></p>
                        {% endif %}

                    
                      



                    </div>
                </div>
            </div>
        {% endfor %}




<div class="pagination">
    {{ knp_pagination_render(events) }}
</div>



    </div>
{% else %}
    <p>Aucun √©v√©nement trouv√©.</p>
{% endif %}

</div>

</section>

<!-- üß† SCRIPT JS -->
<script>
    const minRange = document.getElementById('minRange');
    const maxRange = document.getElementById('maxRange');
    const minAge = document.getElementById('minAge');
    const maxAge = document.getElementById('maxAge');

    minRange.addEventListener('input', () => {
        if (parseInt(minRange.value) > parseInt(maxRange.value)) {
            minRange.value = maxRange.value;
        }
        minAge.textContent = minRange.value;
    });

    maxRange.addEventListener('input', () => {
        if (parseInt(maxRange.value) < parseInt(minRange.value)) {
            maxRange.value = minRange.value;
        }
        maxAge.textContent = maxRange.value;
    });
</script>

<!-- üé® STYLE CSS -->
<style>
    /* --- Structure g√©n√©rale --- */
    .event-container {
        display: flex;
        flex-direction : row;
        justify-content: space-between;
        
        gap: 30px;
        width: 100%;
        padding: 20px;
        box-sizing: border-box;
    }

    /* --- Colonne gauche (Filtres) --- */
    .filters {
        width: 30%;
        background-color: #f5f5f5;
        padding: 20px;
        border-radius: 10px;
    }

    .filters form,
    .filters div {
        margin-bottom: 20px;
    }

    .search-bar {
        display: flex;
        gap: 10px;
    }

    .search-bar input {
        flex: 1;
        padding: 10px;
        border-radius: 5px;
        border: 1px solid #ccc;
    }

    .search-bar button {
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 5px;
        padding: 10px 15px;
    }

    /* --- Colonne droite (Grille des √©v√©nements) --- */
    /* --- Grille d'√©v√©nements --- */
.events-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr); /* 4 √©v√©nements par ligne */
    gap: 30px;
    width: 100%;
    padding: 10px;
    box-sizing: border-box;
}

/* --- Carte d'√©v√©nement --- */
.event-card {
    background: white;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    overflow: hidden;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.event-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.15);
}

.event-image {
    width: 100%;
    height: 180px;
    object-fit: cover;
}

.event-overlay {
    padding: 15px;
}

.event-title {
    font-size: 1.2rem;
    font-weight: bold;
    margin-bottom: 10px;
    color: #333;
}

.event-meta {
    font-size: 0.9rem;
    color: #555;
}

.event-category {
    display: inline-block;
    background-color: #007bff;
    color: white;
    padding: 5px 10px;
    border-radius: 15px;
    font-size: 0.8rem;
    margin-bottom: 8px;
}








{# BTN Filtre & Reinitialisation des FILTRES  #}
.filter-form {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    background: #f9f9f9;
    padding: 1rem;
    border-radius: 10px;
    box-shadow: 0 2px 5px rgba(0,0,0,0.1);
}

.filter-buttons {
    display: flex;
    gap: 10px;
}

.btn-filter {
    background-color: #007bff;
    color: white;
    border: none;
    padding: 0.5rem 1rem;
    border-radius: 6px;
    cursor: pointer;
}

.btn-reset {
    background-color: #e74c3c;
    color: white;
    padding: 0.5rem 1rem;
    border-radius: 6px;
    text-decoration: none;
}

.active-filters {
    margin-top: 1rem;
    background-color: #eef5ff;
    padding: 0.75rem;
    border-radius: 8px;
}

.active-filters ul {
    list-style: none;
    margin: 0;
    padding: 0;
}

.active-filters li {
    margin: 4px 0;
}













{# Btn SUPPRIMER EVENT uniquement visible par ADMIN #}
.btn-delete {
    background-color: #e74c3c;
    color: white;
    border: none;
    padding: 6px 10px;
    border-radius: 6px;
    cursor: pointer;
    transition: background 0.2s ease;
}

.btn-delete:hover {
    background-color: #c0392b;
}















/* --- Responsive --- */
@media (max-width: 1200px) {
    .events-grid {
        grid-template-columns: repeat(3, 1fr);
    }
}

@media (max-width: 800px) {
    .events-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 500px) {
    .events-grid {
        grid-template-columns: 1fr;
    }
}



/* Responsive pour TABLETTE */
 /* ========== MEDIA QUERIES ========== */
            @media (max-width: 768px) {
                .event-container {
                    flex-direction: column; /* colonnes empil√©es */
                }

                .filters, .events-grid {
                    width: 100%; /* occupe toute la largeur */
                }

                .events-grid {
                    grid-template-columns: repeat(1, 1fr); /* 1 √©v√©nement par ligne */
                }

                .footer-columns {
                    flex-direction: column;
                    align-items: center;
                    gap: 2rem;
                }

                .pagination{
                    text-align:center;
                    font-size: 20px;
                }

                header {
                    flex-direction: column;
                    align-items: center;
                    gap: 1rem;
                }

                footer {
                    padding: 2rem;
                    display:flex;
                    flex-direction: column;
                }
            
}



  
</style>

{%  endblock %}


